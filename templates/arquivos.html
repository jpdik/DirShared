<html>
	<head>
		<link rel="stylesheet" type="text/css" href="https://dl.dropboxusercontent.com/s/dlg3vislwofxdcq/estilo.css" />
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
		<title>Dir Shared ({{ nome }})</title>
	</head>
<body>
	<h1>Dir Shared ({{ nome }})</h1>

	<!--<form action={{ nome }}/upload method=post enctype=multipart/form-data>-->
      	
    <input id ="uploadFiles" type=file multiple name=file>
    <input id="upload" type=submit value=Upload>
    <p id="info"></p>
    <!--</form>-->

	<form method="post" action={{ nome }}/download>
		<br /><br />
		<ul id="arquivos">
		{% for i in arquivos %}
		  	<li><a href="{{ nome }}/{{ i['path'].split('/')[-1] }}">{{ i['path'].split('/')[-1] }}</a></li>
		{% endfor %}
		</ul>
		<br /><br />
	</form>

	<p id="info2"></p>
    <input id="apagarTudo" type=submit value="Apagar tudo">
    
    <script src="https://dl.dropboxusercontent.com/s/w7wu7j9f1v4ri6h/jquery-3.1.1.min.js"></script>
    
    <script>
    	$(document).ready(function(){
    		$('#upload').click(function(){
    			$('#info').html('<img src="http://www.cacp.org.br/wp-content/themes/portalcacp1.0/images/loading.gif"></img>');

				var formData = new FormData();
				for(var i=0; i < $('#uploadFiles')[0].files.length; i++){
					var file = $('#uploadFiles').get(0).files[i];
					if(file.size > 10 * 1024 *1024)
						return $('#info').html('Nenhum arquivo pode ser maior que 10 MB');
					formData.append('file', file);
				}

				$.ajax({
			       url: window.location.href+'/upload',
			       //Ajax events
			       success: function (e) {
			       		var resp = JSON.parse(e);
			        	$('#info').html(resp['msg']);
			        	obterArquivos();
			       },
			       error: function (e) {
			       		$('#info').html('error ' + e.message);
			       		location.reload();
			       },
			       // Form data
			       data: formData,
			       type: 'POST',
			       //Options to tell jQuery not to process data or worry about content-type.
			       cache: false,
			       contentType: false,
			       processData: false
			    });
	    	});

	    	$('#apagarTudo').click(function(){
    			$('#info2').html('<img src="http://www.cacp.org.br/wp-content/themes/portalcacp1.0/images/loading.gif"></img>');

				$.ajax({
			       url: window.location.href+'/apagar',
			       //Ajax events
			       success: function (e) {
			       		var resp = JSON.parse(e);
			        	$('#info2').html(resp['msg']);
			        	obterArquivos();
			       },
			       error: function (e) {
			       		var resp = JSON.parse(e);
			       		$('#info2').html('error ' + resp['msg']);
			       		location.reload();
			       },
			       type: 'DELETE',
			       //Options to tell jQuery not to process data or worry about content-type.
			       cache: false,
			       contentType: false,
			       processData: false
			    });
	    	});

	    	function obterArquivos(){
	    		$.ajax({
			       url: window.location.href+'/obter',
			       //Ajax events
			       success: function (e) {
			       		var resp = JSON.parse(e);
			       		$('#arquivos').html('');
			       		for(var i in resp['arquivos'])
			        		$('#arquivos').append('<a href=\"{{ nome }}/'+resp['arquivos'][i]+'\">'+resp['arquivos'][i]+'</a><br />');
			       },
			       error: function (e) {
			       		alert('Ocorreu um erro ao carregar os arquivos. A pagina ser√° recarregada.');
			       		location.reload();
			       },
			       type: 'GET',
			       //Options to tell jQuery not to process data or worry about content-type.
			       cache: false,
			       contentType: false,
			       processData: false
			    });	
	    	}
    	});
    </script>
</body>
</html>